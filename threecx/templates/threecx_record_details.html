{% extends 'base.html' %}
{% block content %}

<h2 class="text-center mb-4">3CX Customer Details</h2>

<div class="table-responsive" style="max-width: 600px; margin: auto;">
  <table class="table table-bordered table-hover align-middle">
    <tbody>
      <!-- Customer Info -->
      <tr>
        <th scope="row"><i class="bi bi-building me-2 text-secondary"></i>Company Name</th>
        <td>{{ customer_record.company_name }}</td>
      </tr>
      <tr>
        <th scope="row"><i class="bi bi-envelope-fill me-2 text-secondary"></i>Email</th>
        <td>{{ customer_record.email_address }}</td>
      </tr>
      <tr>
        <th scope="row"><i class="bi bi-telephone-fill me-2 text-secondary"></i>Contact Details</th>
        <td>{{ customer_record.contact_details }}</td>
      </tr>
      <tr>
        <th scope="row"><i class="bi bi-globe me-2 text-secondary"></i>FQDN</th>
        <td>{{ customer_record.fqdn }}</td>
      </tr>
      <tr>
        <th scope="row"><i class="bi bi-router me-2 text-secondary"></i>SIP Provider</th>
        <td>{{ customer_record.get_sip_provider_display }}</td>
      </tr>
      <tr>
        <th scope="row"><i class="bi bi-award-fill me-2 text-secondary"></i>License Type</th>
        <td>{{ customer_record.get_license_type_display }}</td>
      </tr>
      <tr>
        <th scope="row"><i class="bi bi-calendar-plus me-2 text-muted"></i>Created On</th>
        <td>
          {{ customer_record.created_at|date:"M d, Y H:i" }}
          {% if customer_record.created_by %}
            by <strong>{{ customer_record.created_by.get_full_name|default:customer_record.created_by.email }}</strong>
          {% endif %}
        </td>
      </tr>
      <tr>
        <th scope="row"><i class="bi bi-calendar-check me-2 text-muted"></i>Last Updated</th>
        <td>
          {{ customer_record.last_updated|date:"M d, Y H:i" }}
          {% if customer_record.updated_by %}
            by <strong>{{ customer_record.updated_by.get_full_name|default:customer_record.updated_by.email }}</strong>
          {% endif %}
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Action Buttons -->
<div class="d-flex justify-content-center gap-2 mt-4">
  <a href="{% url 'threecx_records' %}" class="btn btn-outline-secondary">
    <i class="bi bi-arrow-left-circle me-1"></i>Go Back
  </a>
  <a href="#" 
     class="btn btn-outline-danger" 
     onclick="confirmAction(this)"
     data-url="{% url 'delete_threecx_record' customer_record.id %}" 
     data-message="Are you sure you want to delete this record? This action cannot be undone.">
    <i class="bi bi-trash me-1"></i>Delete
  </a>
  <a href="{% url 'update_threecx_record' customer_record.id %}" class="btn btn-outline-primary">
    <i class="bi bi-pencil-square me-1"></i>Update
  </a>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="confirmActionModal" tabindex="-1" aria-labelledby="confirmActionLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title" id="confirmActionLabel">Confirm Deletion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p id="confirmMessage">Are you sure?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <a href="#" class="btn btn-danger" id="confirmBtn">Yes, delete</a>
      </div>
    </div>
  </div>
</div>

<!-- JS Logic -->
<script>
function confirmAction(element) {
  const url = element.getAttribute('data-url');
  const message = element.getAttribute('data-message');

  document.getElementById('confirmMessage').innerText = message;
  document.getElementById('confirmBtn').setAttribute('href', url);

  const modal = new bootstrap.Modal(document.getElementById('confirmActionModal'));
  modal.show();
}
</script>

{% endblock %}
